# Техническое задание на разработку приложения VideoNova

## 1. Общее описание проекта

1.1 VideoNova — это кроссплатформенное десктопное приложение для автоматизированного перевода видео с YouTube и других видеоплатформ. Приложение позволяет пользователю загрузить видео с видеоплатформы, извлечь из него аудио, распознать речь, перевести субтитры на другой язык, синтезировать речь на целевом языке и создать новую версию видео с переведенной аудиодорожкой и субтитрами.

1.2 Дизайн приложения с использованием Ant Design 5.0 в современном аккуратном симметричном стиле.

## 2. Техническая архитектура

### 2.1. Платформа и фреймворки
- **Electron 35.x**: основной фреймворк для создания кроссплатформенных приложений с использованием TypeScript для бэкенда и веб-технологий для фронтенда
- **NodeJS 22.x**: язык программирования для бэкенда и фронтенда
- **React v19**: JavaScript-фреймворк для фронтенд-части
- **TypeScript**: типизированный JavaScript для фронтенд-разработки
- **Ant Design 5.0**: библиотека компонентов для пользовательского интерфейса
- **Vite**: build tool

## 3. Внешние зависимости и интеграции

### 3.1. Внешние API
- **OpenAI API**: для распознавания речи, перевода текста и синтеза речи

### 3.2. Внешние утилиты
- **yt-dlp**: для загрузки видео с YouTube и других видеоплатформ и получения информации о видео
- **ffmpeg**: для работы с аудио и видео файлами
- **Demucs**: для разделения голоса и инструментальной дорожки
- **Soundtouch**: для выравнивания тона и изменения скорости аудио
- **Whisper, Vosk**: Распознавание голоса и перевод в текст (оффлайн режим)
- **Fish Speech**: Text to speech локальная модель (оффлайн режим)
- **Ollama**: Для запуска локальных LLM (оффлайн режим)


### 4 Архитектура приложения
- **Фронтенд (React v19)**:
  - Отвечает за пользовательский интерфейс
  - Взаимодействует с бэкендом через Electron API
  - Отображает прогресс выполнения операций
  - Тонкий фронтенд с минимумом бизнес-логики

- **Бэкенд (NodeJS 22.x)**:
  - Основная логика приложения
  - Управление внешними утилитами и API
  - Обработка аудио и видео
  - Асинхронное выполнение операций

## 5. Основные функциональные возможности

### 5.1. Загрузка видео
- Получение информации о видео по ссылке (YouTube или другая видеоплатформа, поддерживаемая утилитой yt-dlp)
- Определение языка исходного видео по метаданным полученным через yt-dlp (если доступны)
- Загрузка видео и аудио с использованием yt-dlp
- Отображение прогресса загрузки
- Возможность отмены загрузки
- Загрузка оригинальных субтитров, если есть

### 5.2. Распознавание речи
- Извлечение аудиодорожки из видео (если на шаге 1 не скачали отдельно)
- Разделение вокальной дорожки и инструментальной дорожки (включая интершумы и все остальные звуки кроме голоса) с помощью библиотеки Demucs
- Распознавание речи с использованием OpenAI Whisper API (если не скачали субтитры на шаге 1)
- Сохранение результатов в формате VTT (субтитры)


### 5.3. Перевод текста
- Перевод субтитров с использованием OpenAI API или оффлайн LLM через Ollama
- Сохранение переведенных субтитров в формате VTT

### 5.4. Синтез речи
- Использование OpenAI TTS API для качественного синтеза речи (или оффлайн утилита)
- Адаптация VTT-перевода под таймфреймы исходного аудио, чтобы текст звучал естественно без ускорений (максимальное ускорение 1.5)
- Генерация голосовой аудиодорожки на основе переведенного текста
- Регулировка скорости и тона речи для лучшей синхронизации с помощью Soundtouch.


### 5.5. Обработка и объединение видео
- Использование ffmpeg для финальной обработки
- Объединение новой аудиодорожки с инструментальной аудиодорожкой, полученной на шаге "Распознавание речи"
- Объединение исходного видео с новой микшированной аудиодорожкой и установка этой дорожки в видео как основной
- Добавление субтитров (оригинальных и переведенных)
- Возможность выбора формата выходного видео (по-умолчанию формат совместимый с quicktime player и windows media player)

### 5.6. Управление зависимостями
- Автоматическая проверка наличия необходимых внешних инструментов (yt-dlp, ffmpeg, Demucs, Soundtouch, Whisper, Vosk, Fish Speech, Ollama)
- Автоматическая загрузка и обновление внешних инструментов при необходимости
- При запуске программы проверка доступноcти ресурсов API OpenAI и YouTube. В случае недоступности показывать рекмендацию включить VPN.
- Управление зависимостями должно выполняться при запуске приложения



## 6. Пользовательский интерфейс

### 6.1. Главный экран: окно ввода данных (слева)
- Поле для ввода ссылки на видео
- Кнопка выбора директории для сохранения результатов
- Выпадающие списки с выбором исходного и целевого языков
- Кнопка для запуска процесса обработки (после запуска кнопка меняет функционал на кнопку отмены операции)

### 6.2. Экран настроек
- Добавление API-ключа OpenAI
- Выбор SpeechToText: OpenAI или локальная модель (например Whisper, Vosk)
- Выбор LLM для перевода: OpenAI или локальная модель на базе Ollama (например Qwen 2.5)
- Выбор TTS: OpenAI или локальная модель (например Fish Speech)
- Выбор голоса для синтеза речи (зависит от выбранного движка TTS)
- При выборе в настройках локальных моделей - необходимо предупреждать пользователя, что они будет скачана и надо подождать. Реализовать экран скачивания и установки

### 6.3. Главный экран: Отображение прогресса (справа)
- Пошаговое отображение текущего шага обработки
- Вывод логов и ошибок


## 7. Обработка ошибок и исключительных ситуаций

### 7.1. Проверка доступности сервисов
- Проверка доступности YouTube и OpenAI API
- Определение необходимости использования VPN
- Уведомление пользователя о проблемах с доступом

### 7.2. Валидация API-ключей
- Проверка валидности API-ключа OpenAI
- Безопасное хранение ключей в зашифрованном хранилище
- Инструкции по получению API-ключей

### 7.3. Обработка ошибок сети
- Повторные попытки при сбоях сети
- Возобновление загрузки после прерывания
- Информативные сообщения об ошибках

## 8. Особенности реализации

### 8.1. Многопоточность и асинхронность
- Асинхронное выполнение тяжелых операций
- Использование многопоточности для ускорения обработки
- Предотвращение блокировки UI во время выполнения задач

### 8.2. Кэширование и оптимизация
- Сохранение промежуточных результатов на диск в выбранную пользователем папку на первом шаге (в папку {selected_folder}/temp)
- Возможность возобновления с этапа где прервались в прошлый раз (определяется по наличию файлов во временной папке)
- Оптимизация использования API для снижения затрат

### 8.3. Безопасность
- Безопасное хранение API-ключей
- Очистка временных файлов
- Работа в изолированной среде
- Хранение всех настроек в постоянном хранилище или json-файле


### 8.4 При первой загрузке приложения показываем пользователю окно настроек, чтобы он выбрал, какие модели использовать для обработки - локальные или OpenAI. Если локальные - сначала скачиваем, устанавливаем, показывая пользователю прогресс выполнения скачивания и установки необходимых пакетов. Затем показываем основное окно программы.

## 9. Дальнейшее развитие проекта
- Пакетная обработка нескольких видео
- Улучшение алгоритмов синхронизации аудио и видео
